function Banners(){}Banners.prototype.loadData=function(){var r=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code){var e=n.data;console.log(e);for(var a=0;a<e.length;a++){var t=e[a];r.createBannerItem(t)}}}})},Banners.prototype.createBannerItem=function(n){var e=this,a=template("banner-item",{banner:n}),t=$(".banner-list-group"),r=null;r=n?(t.append(a),t.find(".banner-item:last")):(t.prepend(a),t.find(".banner-item:first")),e.addImageSelectEvent(r),e.addRemoveBannerEvent(r),e.addSaveBannerEvent(r)},Banners.prototype.listenAddBannerEvent=function(){var n=this;$("#add-banner-btn").click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("最多只能添加6张轮播图！"):n.createBannerItem()})},Banners.prototype.addRemoveBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗?",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("轮播图删除才成功！"))}})}}):e.remove()})},Banners.prototype.addImageSelectEvent=function(n){var a=n.find(".thumbnail"),e=n.find(".image-input");a.click(function(){e.click()}),e.change(function(){var n=this.files[0],e=new FormData;e.append("file",n),xfzajax.post({url:"/cms/upload_file/",data:e,processData:!1,contentType:!1,success:function(n){if(200===n.code){var e=n.data.url;a.attr("src",e)}}})})},Banners.prototype.addSaveBannerEvent=function(t){var n=t.find(".save-btn"),r=t.find(".thumbnail"),o=t.find("input[name='priority']"),i=t.find("input[name='link_to']"),c=t.find('span[class="priority"]'),s=t.attr("data-banner-id"),d="";d=s?"/cms/edit_banner/":"/cms/add_banner/",n.click(function(){var n=r.attr("src"),e=o.val(),a=i.val();xfzajax.post({url:d,data:{image_url:n,priority:e,link_to:a,pk:s},success:function(n){200===n.code&&(s?window.messageBox.showSuccess("轮播图修改成功！"):(s=n.data.banner_id,t.attr("data-banner-id",s),window.messageBox.showSuccess("轮播图添加完成！")),c.text("优先级："+e))}})})},Banners.prototype.addRemoveBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗?",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("轮播图删除才成功！"))}})}}):e.remove()})},Banners.prototype.run=function(){this.listenAddBannerEvent(),this.loadData()},$(function(){(new Banners).run()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhbm5lci5qcyJdLCJuYW1lcyI6WyJCYW5uZXJzIiwicHJvdG90eXBlIiwibG9hZERhdGEiLCJzZWxmIiwidGhpcyIsInhmemFqYXgiLCJnZXQiLCJ1cmwiLCJzdWNjZXNzIiwicmVzdWx0IiwiYmFubmVycyIsImNvbnNvbGUiLCJsb2ciLCJpIiwibGVuZ3RoIiwiYmFubmVyIiwiY3JlYXRlQmFubmVySXRlbSIsInRwbCIsInRlbXBsYXRlIiwiYmFubmVyTGlzdEdyb3VwIiwiJCIsImJhbm5lckl0ZW0iLCJhcHBlbmQiLCJmaW5kIiwicHJlcGVuZCIsImFkZEltYWdlU2VsZWN0RXZlbnQiLCJhZGRSZW1vdmVCYW5uZXJFdmVudCIsImFkZFNhdmVCYW5uZXJFdmVudCIsImxpc3RlbkFkZEJhbm5lckV2ZW50IiwiY2xpY2siLCJjaGlsZHJlbiIsIndpbmRvdyIsIm1lc3NhZ2VCb3giLCJzaG93SW5mbyIsImJhbm5lcklkIiwiYXR0ciIsInhmemFsZXJ0IiwiYWxlcnRDb25maXJtIiwidGV4dCIsImNvbmZpcm1DYWxsYmFjayIsInBvc3QiLCJkYXRhIiwiYmFubmVyX2lkIiwicmVtb3ZlIiwic2hvd1N1Y2Nlc3MiLCJpbWFnZSIsImltYWdlSW5wdXQiLCJjaGFuZ2UiLCJmaWxlIiwiZmlsZXMiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwicHJvY2Vzc0RhdGEiLCJjb250ZW50VHlwZSIsInNhdmVCdG4iLCJpbWFnZVRhZyIsInByaW9yaXR5VGFnIiwibGlua3RvVGFnIiwicHJpb3JpdHlTcGFuIiwiaW1hZ2VfdXJsIiwicHJpb3JpdHkiLCJ2YWwiLCJsaW5rX3RvIiwicGsiLCJydW4iXSwibWFwcGluZ3MiOiJBQUFBLFNBQVNBLFdBSVRBLFFBQVFDLFVBQVVDLFNBQVcsV0FDekIsSUFBSUMsRUFBT0MsS0FDWEMsUUFBUUMsSUFBSSxDQUNSQyxJQUFPLG9CQUNQQyxRQUFXLFNBQVVDLEdBQ2pCLEdBQXNCLE1BQW5CQSxFQUFhLEtBQVUsQ0FDdEIsSUFBSUMsRUFB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LFFBQVFDLFVBQVV5QixxQkFBdUIsU0FBVUwsR0FDaENBLEVBQVdFLEtBQUssY0FFdEJNLE1BQU0sV0FDWCxJQUFJSyxFQUFXYixFQUFXYyxLQUFLLGtCQUM1QkQsRUFDQ0UsU0FBU0MsYUFBYSxDQUNsQkMsS0FBUSxnQkFDUkMsZ0JBQW1CLFdBQ2ZsQyxRQUFRbUMsS0FBSyxDQUNUakMsSUFBTyxzQkFDUGtDLEtBQVEsQ0FDSkMsVUFBYVIsR0FFakIxQixRQUFXLFNBQVVDLEdBQ0ssTUFBbkJBLEVBQWEsT0FDWlksRUFBV3NCLFNBQ1haLE9BQU9DLFdBQVdZLFlBQVksb0JBT2xEdkIsRUFBV3NCLFlBT3ZCM0MsUUFBUUMsVUFBVStELElBQU0sV0FDcEI1RCxLQUFLd0IsdUJBQ0x4QixLQUFLRixZQUdUa0IsRUFBRSxZQUNnQixJQUFJcEIsU0FDVmdFIiwiZmlsZSI6ImJhbm5lci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBCYW5uZXJzKCkge1xyXG5cclxufVxyXG5cclxuQmFubmVycy5wcm90b3R5cGUubG9hZERhdGEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB4ZnphamF4LmdldCh7XHJcbiAgICAgICAgJ3VybCc6ICcvY21zL2Jhbm5lcl9saXN0LycsXHJcbiAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGlmKHJlc3VsdFsnY29kZSddID09PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIGJhbm5lcnMgPSByZXN1bHRbJ2RhdGEnXTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGJhbm5lcnMpO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8YmFubmVycy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFubmVyID0gYmFubmVyc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oYmFubmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUuY3JlYXRlQmFubmVySXRlbSA9IGZ1bmN0aW9uIChiYW5uZXIpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0cGwgPSB0ZW1wbGF0ZShcImJhbm5lci1pdGVtXCIse1wiYmFubmVyXCI6YmFubmVyfSk7XHJcbiAgICB2YXIgYmFubmVyTGlzdEdyb3VwID0gJChcIi5iYW5uZXItbGlzdC1ncm91cFwiKTtcclxuXHJcbiAgICB2YXIgYmFubmVySXRlbSA9IG51bGw7XHJcbiAgICBpZihiYW5uZXIpe1xyXG4gICAgICAgIGJhbm5lckxpc3RHcm91cC5hcHBlbmQodHBsKTtcclxuICAgICAgICBiYW5uZXJJdGVtID0gYmFubmVyTGlzdEdyb3VwLmZpbmQoXCIuYmFubmVyLWl0ZW06bGFzdFwiKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIGJhbm5lckxpc3RHcm91cC5wcmVwZW5kKHRwbCk7XHJcbiAgICAgICAgYmFubmVySXRlbSA9IGJhbm5lckxpc3RHcm91cC5maW5kKFwiLmJhbm5lci1pdGVtOmZpcnN0XCIpO1xyXG4gICAgfVxyXG4gICAgICAgc2VsZi5hZGRJbWFnZVNlbGVjdEV2ZW50KGJhbm5lckl0ZW0pO1xyXG4gICAgICAgc2VsZi5hZGRSZW1vdmVCYW5uZXJFdmVudChiYW5uZXJJdGVtKTtcclxuICAgICAgIHNlbGYuYWRkU2F2ZUJhbm5lckV2ZW50KGJhbm5lckl0ZW0pO1xyXG59O1xyXG5cclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmxpc3RlbkFkZEJhbm5lckV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIGFkZEJ0biA9ICQoXCIjYWRkLWJhbm5lci1idG5cIik7XHJcbiAgICBhZGRCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBiYW5uZXJMaXN0R3JvdXAgPSAkKCcuYmFubmVyLWxpc3QtZ3JvdXAnKTtcclxuICAgICAgICB2YXIgbGVuZ3RoID0gYmFubmVyTGlzdEdyb3VwLmNoaWxkcmVuKCkubGVuZ3RoO1xyXG4gICAgICAgIGlmKGxlbmd0aCA+PSA2KXtcclxuICAgICAgICAgICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd0luZm8oJ+acgOWkmuWPquiDvea3u+WKoDblvKDova7mkq3lm77vvIEnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUuYWRkUmVtb3ZlQmFubmVyRXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGNsb3NlQnRuID0gYmFubmVySXRlbS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcblxyXG4gICAgY2xvc2VCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBiYW5uZXJJZCA9IGJhbm5lckl0ZW0uYXR0cignZGF0YS1iYW5uZXItaWQnKTtcclxuICAgICAgICBpZihiYW5uZXJJZCl7XHJcbiAgICAgICAgICAgIHhmemFsZXJ0LmFsZXJ0Q29uZmlybSh7XHJcbiAgICAgICAgICAgICAgICAndGV4dCc6ICfmgqjnoa7lrpropoHliKDpmaTov5nkuKrova7mkq3lm77lkJc/JyxcclxuICAgICAgICAgICAgICAgICdjb25maXJtQ2FsbGJhY2snOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICcvY21zL2RlbGV0ZV9iYW5uZXIvJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFubmVyX2lkJzogYmFubmVySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfova7mkq3lm77liKDpmaTmiY3miJDlip/vvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgYmFubmVySXRlbS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmFkZEltYWdlU2VsZWN0RXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGltYWdlID0gYmFubmVySXRlbS5maW5kKCcudGh1bWJuYWlsJyk7XHJcbiAgICB2YXIgaW1hZ2VJbnB1dCA9IGJhbm5lckl0ZW0uZmluZCgnLmltYWdlLWlucHV0Jyk7XHJcbiAgICAvLyDlm77niYfmmK/kuI3og73lpJ/miZPlvIDmlofku7bpgInmi6nmoYbnmoTvvIzlj6rog73pgJrov4dpbnB1dFt0eXBlPSdmaWxlJ11cclxuICAgIGltYWdlLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpbWFnZUlucHV0LmNsaWNrKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpbWFnZUlucHV0LmNoYW5nZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZpbGUgPSB0aGlzLmZpbGVzWzBdO1xyXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIixmaWxlKTtcclxuICAgICAgICB4ZnphamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzogJy9jbXMvdXBsb2FkX2ZpbGUvJyxcclxuICAgICAgICAgICAgJ2RhdGEnOiBmb3JtRGF0YSxcclxuICAgICAgICAgICAgJ3Byb2Nlc3NEYXRhJzogZmFsc2UsXHJcbiAgICAgICAgICAgICdjb250ZW50VHlwZSc6IGZhbHNlLFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3VsdFsnY29kZSddID09PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSByZXN1bHRbJ2RhdGEnXVsndXJsJ107XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2UuYXR0cignc3JjJyx1cmwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmFkZFNhdmVCYW5uZXJFdmVudCA9IGZ1bmN0aW9uIChiYW5uZXJJdGVtKSB7XHJcbiAgICB2YXIgc2F2ZUJ0biA9IGJhbm5lckl0ZW0uZmluZCgnLnNhdmUtYnRuJyk7XHJcbiAgICB2YXIgaW1hZ2VUYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCIudGh1bWJuYWlsXCIpO1xyXG4gICAgdmFyIHByaW9yaXR5VGFnID0gYmFubmVySXRlbS5maW5kKFwiaW5wdXRbbmFtZT0ncHJpb3JpdHknXVwiKTtcclxuICAgIHZhciBsaW5rdG9UYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCJpbnB1dFtuYW1lPSdsaW5rX3RvJ11cIik7XHJcbiAgICB2YXIgcHJpb3JpdHlTcGFuID0gYmFubmVySXRlbS5maW5kKCdzcGFuW2NsYXNzPVwicHJpb3JpdHlcIl0nKTtcclxuICAgIHZhciBiYW5uZXJJZCA9IGJhbm5lckl0ZW0uYXR0cihcImRhdGEtYmFubmVyLWlkXCIpO1xyXG4gICAgdmFyIHVybCA9ICcnO1xyXG4gICAgaWYoYmFubmVySWQpe1xyXG4gICAgICAgIHVybCA9ICcvY21zL2VkaXRfYmFubmVyLyc7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB1cmwgPSAnL2Ntcy9hZGRfYmFubmVyLyc7XHJcbiAgICB9XHJcbiAgICBzYXZlQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW1hZ2VfdXJsID0gaW1hZ2VUYWcuYXR0cignc3JjJyk7XHJcbiAgICAgICAgdmFyIHByaW9yaXR5ID0gcHJpb3JpdHlUYWcudmFsKCk7XHJcbiAgICAgICAgdmFyIGxpbmtfdG8gPSBsaW5rdG9UYWcudmFsKCk7XHJcbiAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgJ3VybCc6IHVybCxcclxuICAgICAgICAgICAgJ2RhdGEnOntcclxuICAgICAgICAgICAgICAgICdpbWFnZV91cmwnOiBpbWFnZV91cmwsXHJcbiAgICAgICAgICAgICAgICAncHJpb3JpdHknOiBwcmlvcml0eSxcclxuICAgICAgICAgICAgICAgICdsaW5rX3RvJzogbGlua190byxcclxuICAgICAgICAgICAgICAgICdwayc6IGJhbm5lcklkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYocmVzdWx0Wydjb2RlJ10gPT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYmFubmVySWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2Vzcygn6L2u5pKt5Zu+5L+u5pS55oiQ5Yqf77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhbm5lcklkID0gcmVzdWx0WydkYXRhJ11bJ2Jhbm5lcl9pZCddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLmF0dHIoJ2RhdGEtYmFubmVyLWlkJyxiYW5uZXJJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfova7mkq3lm77mt7vliqDlrozmiJDvvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlTcGFuLnRleHQoXCLkvJjlhYjnuqfvvJpcIitwcmlvcml0eSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUuYWRkUmVtb3ZlQmFubmVyRXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGNsb3NlQnRuID0gYmFubmVySXRlbS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcblxyXG4gICAgY2xvc2VCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBiYW5uZXJJZCA9IGJhbm5lckl0ZW0uYXR0cignZGF0YS1iYW5uZXItaWQnKTtcclxuICAgICAgICBpZihiYW5uZXJJZCl7XHJcbiAgICAgICAgICAgIHhmemFsZXJ0LmFsZXJ0Q29uZmlybSh7XHJcbiAgICAgICAgICAgICAgICAndGV4dCc6ICfmgqjnoa7lrpropoHliKDpmaTov5nkuKrova7mkq3lm77lkJc/JyxcclxuICAgICAgICAgICAgICAgICdjb25maXJtQ2FsbGJhY2snOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICcvY21zL2RlbGV0ZV9iYW5uZXIvJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFubmVyX2lkJzogYmFubmVySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfova7mkq3lm77liKDpmaTmiY3miJDlip/vvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgYmFubmVySXRlbS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5cclxuQmFubmVycy5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5saXN0ZW5BZGRCYW5uZXJFdmVudCgpO1xyXG4gICAgdGhpcy5sb2FkRGF0YSgpXHJcbn07XHJcblxyXG4kKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBiYW5uZXJzID0gbmV3IEJhbm5lcnMoKTtcclxuICAgIGJhbm5lcnMucnVuKCk7XHJcbn0pOyJdfQ==
